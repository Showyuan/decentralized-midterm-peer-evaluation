# å»ä¸­å¿ƒåŒ–æœŸä¸­è€ƒåŒå„•äº’è©•ç³»çµ±

> **å°ˆæ¡ˆç‹€æ…‹ï¼š** âœ… ç”Ÿç”¢å°±ç·’  
> **æœ€å¾Œæ›´æ–°ï¼š** 2025-10-06  
> **ç‰ˆæœ¬ï¼š** v2.0

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)](https://www.python.org/)
[![Flask](https://img.shields.io/badge/Flask-3.0+-green.svg)](https://flask.palletsprojects.com/)
[![Status](https://img.shields.io/badge/Status-Production-success.svg)](https://ntublockchainintro2025.online/)

---

## ğŸ“‹ ç›®éŒ„

- [å°ˆæ¡ˆæ¦‚è¿°](#å°ˆæ¡ˆæ¦‚è¿°)
- [ç³»çµ±æ¶æ§‹](#ç³»çµ±æ¶æ§‹)
- [å¿«é€Ÿé–‹å§‹](#å¿«é€Ÿé–‹å§‹)
- [å®Œæ•´å·¥ä½œæµç¨‹](#å®Œæ•´å·¥ä½œæµç¨‹)
- [è‡ªå‹•åŒ–è…³æœ¬](#è‡ªå‹•åŒ–è…³æœ¬)
- [æŠ€è¡“è¦æ ¼](#æŠ€è¡“è¦æ ¼)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [å¸¸è¦‹å•é¡Œ](#å¸¸è¦‹å•é¡Œ)

---

## å°ˆæ¡ˆæ¦‚è¿°

### ï¿½ï¿½ æ ¸å¿ƒç›®æ¨™

å°‡å‚³çµ±çš„æ‰‹å‹•æœŸä¸­è€ƒè©•åˆ†æµç¨‹ï¼Œè½‰è®Šç‚º**ç·šä¸Šå»ä¸­å¿ƒåŒ–åŒå„•äº’è©•ç³»çµ±**ï¼Œé€é Vancouver æ¼”ç®—æ³•æ¶ˆé™¤è©•åˆ†åå·®ï¼Œç¢ºä¿è©•åˆ†çš„å…¬å¹³æ€§èˆ‡å®¢è§€æ€§ã€‚

### âœ¨ æ ¸å¿ƒåŠŸèƒ½

- âœ… **å»ä¸­å¿ƒåŒ–è©•åˆ†** - Vancouver æ¼”ç®—æ³•è‡ªå‹•èª¿æ•´è©•åˆ†åå·®
- âœ… **å®Œæ•´åŒ¿åä¿è­·** - è©•åˆ†è€…ä¸çŸ¥é“è¢«è©•åˆ†è€…èº«ä»½
- âœ… **Web è©•åˆ†ä»‹é¢** - ç¾ä»£åŒ–çš„ç·šä¸Šè©•åˆ†é«”é©—
- âœ… **è‡ªå‹•åŒ–æµç¨‹** - Token ç”Ÿæˆã€Email ç™¼é€ã€çµæœæ”¶é›†å…¨è‡ªå‹•
- âœ… **å³æ™‚ç›£æ§** - ç®¡ç†å„€è¡¨æ¿è¿½è¹¤æ‰€æœ‰å­¸ç”Ÿçš„æäº¤é€²åº¦
- âœ… **å®‰å…¨æ©Ÿåˆ¶** - Token é©—è­‰ã€ä¸€æ¬¡æ€§ä½¿ç”¨ã€IP è¨˜éŒ„

### ğŸ“Š ç³»çµ±ç‰¹è‰²

**å­¸ç”Ÿç«¯ï¼š**
- ğŸ“§ æ”¶åˆ°å€‹äººåŒ–è©•åˆ†é€£çµ (4 å€‹è©•åˆ†ä»»å‹™)
- ğŸ”— é»æ“Šé€£çµå³å¯é–‹å§‹è©•åˆ†
- ğŸ“ æŸ¥çœ‹è¢«è©•åˆ†è€…çš„å®Œæ•´ç­”æ¡ˆ
- â­ å°æ¯é¡Œè©•åˆ† (Q1-Q5) + æ’°å¯«è©•èª
- âœ… æäº¤å¾Œå³æ™‚ç¢ºèª

**ç®¡ç†ç«¯ï¼š**
- ğŸ“Š å³æ™‚ç›£æ§æ‰€æœ‰å­¸ç”Ÿæäº¤ç‹€æ…‹
- ï¿½ï¿½ è‡ªå‹•ç™¼é€æé†’çµ¦æœªå®Œæˆè€…
- ğŸ“ˆ å®Œæ•´çš„çµ±è¨ˆåˆ†æ
- ğŸ“„ å¤šæ ¼å¼æˆç¸¾å ±è¡¨ (JSON, Excel)
- ğŸ” é©—è­‰å ±å‘Šç¢ºä¿è¨ˆç®—æ­£ç¢ºæ€§

---

## å¿«é€Ÿé–‹å§‹

### å‰ç½®éœ€æ±‚

- Python 3.10+
- SQLite 3
- Gmail å¸³è™Ÿ (ç”¨æ–¼ç™¼é€ Email)
- Linux Server (å»ºè­° Ubuntu 20.04+)

### å®‰è£æ­¥é©Ÿ

```bash
# 1. Clone å°ˆæ¡ˆ
git clone https://github.com/Showyuan/decentralized-midterm-peer-evaluation.git
cd decentralized-midterm-peer-evaluation

# 2. å»ºç«‹è™›æ“¬ç’°å¢ƒ
python3 -m venv venv
source venv/bin/activate

# 3. å®‰è£ä¾è³´
pip install -r requirements.txt

# 4. è¨­å®šç’°å¢ƒè®Šæ•¸
cp .env.example .env
nano .env  # ç·¨è¼¯ SMTP è¨­å®š

# 5. åˆå§‹åŒ–ç³»çµ±
./run_setup_and_init.sh
```

### å¿«é€ŸåŸ·è¡Œ

```bash
# å®Œæ•´æµç¨‹ (ä¸‰æ­¥é©Ÿ)
./run_setup_and_init.sh      # 1. åˆå§‹åŒ–ç³»çµ±
./run_send_emails.sh          # 2. ç™¼é€è©•åˆ†é€šçŸ¥
# ... ç­‰å¾…å­¸ç”Ÿå®Œæˆè©•åˆ† ...
./run_collect_and_grade.sh   # 3. æ”¶é›†ä¸¦è¨ˆç®—æˆç¸¾
```

---

## å®Œæ•´å·¥ä½œæµç¨‹

### éšæ®µ 1: ç³»çµ±åˆå§‹åŒ–

**è…³æœ¬**: `./run_setup_and_init.sh`

**åŸ·è¡Œå…§å®¹**:
1. ğŸ“„ è®€å–å­¸ç”Ÿè³‡æ–™ (CSV â†’ JSON)
2. ğŸ² éš¨æ©Ÿåˆ†é…è©•åˆ†ä»»å‹™ (æ¯äººè©• 4 ä»½)
3. ğŸ”‘ ç”Ÿæˆè©•é‡ Token (UUID å”¯ä¸€èªè­‰)
4. ğŸ’¾ å»ºç«‹ SQLite è³‡æ–™åº«
5. ğŸ“Š å°å…¥ Tokens å’Œå­¸ç”Ÿè³‡æ–™
6. ğŸŒ é‡å•Ÿ Web æœå‹™

**è¼¸å‡ºæª”æ¡ˆ**:
```
workflow_results/
â”œâ”€â”€ 1_data_preparation/
â”‚   â””â”€â”€ midterm_data.json
â”œâ”€â”€ 2_assignment/
â”‚   â””â”€â”€ peer_assignments.json
â”œâ”€â”€ 3_token_generation/
â”‚   â”œâ”€â”€ evaluation_tokens_*.json
â”‚   â””â”€â”€ evaluation_urls_*.json
â””â”€â”€ 4_database/
    â””â”€â”€ evaluation.db
```

### éšæ®µ 2: ç™¼é€è©•åˆ†é€šçŸ¥

**è…³æœ¬**: `./run_send_emails.sh`

**ç™¼é€æ¨¡å¼**:

| æ¨¡å¼ | èªªæ˜ | ç”¨é€” |
|------|------|------|
| **1. æ¸¬è©¦æ¨¡å¼** | é è¦½å…§å®¹ï¼Œä¸å¯¦éš›ç™¼é€ | ç¢ºèªæ ¼å¼ |
| **2. å–®ä¸€å­¸ç”Ÿ** | æŒ‡å®šå­¸è™Ÿç™¼é€ | æ¸¬è©¦æˆ–è£œç™¼ |
| **3. å…¨éƒ¨å­¸ç”Ÿ** | æ‰¹æ¬¡ç™¼é€çµ¦æ‰€æœ‰äºº | æ­£å¼é€šçŸ¥ |
| **4. æœªå®Œæˆè€…** | åƒ…ç™¼é€çµ¦å°šæœªè©•åˆ†è€… | æé†’é€šçŸ¥ |

### éšæ®µ 3: æ”¶é›†çµæœèˆ‡è¨ˆç®—æˆç¸¾

**è…³æœ¬**: `./run_collect_and_grade.sh`

**åŸ·è¡Œå…§å®¹**:
1. ğŸ“Š æª¢æŸ¥è³‡æ–™å®Œæ•´æ€§
2. ğŸ“¥ å¾è³‡æ–™åº«æ”¶é›†è©•åˆ†çµæœ
3. ğŸ“„ ç”Ÿæˆå¤šæ ¼å¼å ±è¡¨
4. ï¿½ï¿½ åŸ·è¡Œ Vancouver æ¼”ç®—æ³•
5. ğŸ“Š ç”Ÿæˆé©—è­‰å ±å‘Š

**è¼¸å‡ºæª”æ¡ˆ**:
```
workflow_results/
â”œâ”€â”€ 5_evaluation_results/
â”‚   â”œâ”€â”€ evaluation_results.json
â”‚   â”œâ”€â”€ evaluation_results.xlsx
â”‚   â””â”€â”€ vancouver_input.json
â”œâ”€â”€ 6_vancouver_results/
â”‚   â”œâ”€â”€ vancouver_results_*.json
â”‚   â””â”€â”€ vancouver_results_*.xlsx  â­ æœ€çµ‚æˆç¸¾å–®
â””â”€â”€ 7_final_reports/
    â””â”€â”€ vancouver_verification_report.xlsx
```

---

## è‡ªå‹•åŒ–è…³æœ¬

### è…³æœ¬èªªæ˜

| è…³æœ¬ | éšæ®µ | åŠŸèƒ½ | åŸ·è¡Œæ™‚æ©Ÿ |
|------|------|------|----------|
| `run_setup_and_init.sh` | 1 | ç³»çµ±åˆå§‹åŒ– | é¦–æ¬¡éƒ¨ç½²æˆ–é‡ç½® |
| `run_send_emails.sh` | 2 | ç™¼é€é€šçŸ¥ | é–‹å§‹è©•åˆ†æˆ–æé†’ |
| `run_collect_and_grade.sh` | 3 | æ”¶é›†æˆç¸¾ | è©•åˆ†å®Œæˆå¾Œ |

### å…¸å‹ä½¿ç”¨å ´æ™¯

#### å ´æ™¯ A: é¦–æ¬¡éƒ¨ç½²ç³»çµ±

```bash
./run_setup_and_init.sh      # åˆå§‹åŒ–
./run_send_emails.sh          # æ¸¬è©¦æ¨¡å¼ç¢ºèª
./run_send_emails.sh          # æ­£å¼ç™¼é€
# è¨ªå•: https://ntublockchainintro2025.online/ ç›£æ§é€²åº¦
./run_collect_and_grade.sh   # æ”¶é›†æˆç¸¾
```

#### å ´æ™¯ B: æé†’æœªå®Œæˆè€…

```bash
cd peer_evaluation
python3 tool_db_cli.py --stats  # æª¢æŸ¥é€²åº¦
cd ..
./run_send_emails.sh            # é¸æ“‡æ¨¡å¼ 4
```

---

## æŠ€è¡“è¦æ ¼

### æŠ€è¡“å †ç–Š

- **Python 3.10+** - ä¸»è¦é–‹ç™¼èªè¨€
- **Flask 3.0+** - Web æ¡†æ¶
- **SQLite 3** - è³‡æ–™åº«
- **Nginx** - åå‘ä»£ç†
- **Let's Encrypt** - SSL æ†‘è­‰

### è³‡æ–™åº«çµæ§‹

```sql
-- Tokens è¡¨
CREATE TABLE tokens (
    token TEXT PRIMARY KEY,
    evaluator_id TEXT NOT NULL,
    target_id TEXT NOT NULL,
    questions TEXT NOT NULL,
    is_used BOOLEAN DEFAULT 0,
    ...
);

-- Submissions è¡¨
CREATE TABLE submissions (
    id INTEGER PRIMARY KEY,
    token TEXT NOT NULL,
    question_id TEXT NOT NULL,
    score INTEGER NOT NULL,
    comment TEXT,
    ...
);
```

### Vancouver æ¼”ç®—æ³•

**æ ¸å¿ƒåƒæ•¸**:
```python
R_max = 1.0      # æœ€å¤§è²è­½å€¼
v_G = 8.0        # å…¨åŸŸè®Šç•°æ•¸
Î± = 0.1          # æ¿€å‹µæ¬Šé‡
N = 4            # æ¯äººè©•åˆ†æ•¸
```

---

## æ•…éšœæ’é™¤

### å•é¡Œ 1: Web æœå‹™ç„¡æ³•å•Ÿå‹•

```bash
sudo systemctl status peereval
sudo journalctl -u peereval -f
sudo systemctl restart peereval
```

### å•é¡Œ 2: è³‡æ–™åº«é–å®š

```bash
sudo systemctl stop peereval
python3 tool_db_cli.py --stats
sudo systemctl start peereval
```

### å•é¡Œ 3: Email ç™¼é€å¤±æ•—

æª¢æŸ¥ `.env` ä¸­çš„ SMTP è¨­å®šï¼Œç¢ºèªä½¿ç”¨ã€Œæ‡‰ç”¨ç¨‹å¼å°ˆç”¨å¯†ç¢¼ã€ã€‚

---

## å¸¸è¦‹å•é¡Œ

### Q1: å­¸ç”Ÿå¿˜è¨˜è©•åˆ†é€£çµæ€éº¼è¾¦ï¼Ÿ

**A:** é‡æ–°ç™¼é€ Email æˆ–å¾ `evaluation_urls_*.json` æŸ¥æ‰¾ã€‚

### Q2: Token éæœŸäº†æ€éº¼è¾¦ï¼Ÿ

**A:** åœ¨è³‡æ–™åº«ä¸­å»¶é•· `expires_at` æ™‚é–“ã€‚

### Q3: å¦‚ä½•é˜²æ­¢å­¸ç”Ÿäº’ç›¸åˆ†äº« Tokenï¼Ÿ

**A:** ç³»çµ±å·²å…§å»ºä¿è­·ï¼šä¸€æ¬¡æ€§ä½¿ç”¨ã€IP è¨˜éŒ„ã€éæœŸæ©Ÿåˆ¶ã€‚

---

## ç›®éŒ„çµæ§‹

```
decentralized-midterm-peer-evaluation/
â”œâ”€â”€ README.md
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ run_setup_and_init.sh
â”œâ”€â”€ run_send_emails.sh
â”œâ”€â”€ run_collect_and_grade.sh
â”œâ”€â”€ peer_evaluation/
â”‚   â”œâ”€â”€ stage0_config_unified.py
â”‚   â”œâ”€â”€ stage1_data_processor.py
â”‚   â”œâ”€â”€ stage2_assignment_engine.py
â”‚   â”œâ”€â”€ stage2_token_generator.py
â”‚   â”œâ”€â”€ stage3_email_sender.py
â”‚   â”œâ”€â”€ stage3_web_server.py
â”‚   â”œâ”€â”€ stage4_result_collector_web.py
â”‚   â”œâ”€â”€ stage5_vancouver_processor.py
â”‚   â””â”€â”€ templates/
â””â”€â”€ workflow_results/
    â”œâ”€â”€ 1_data_preparation/
    â”œâ”€â”€ 2_assignment/
    â”œâ”€â”€ 3_token_generation/
    â”œâ”€â”€ 4_database/
    â”œâ”€â”€ 5_evaluation_results/
    â”œâ”€â”€ 6_vancouver_results/
    â””â”€â”€ 7_final_reports/
```

---

## æˆæ¬Šæ¢æ¬¾

æœ¬å°ˆæ¡ˆæ¡ç”¨ MIT License

---

## è¯çµ¡è³‡è¨Š

**å°ˆæ¡ˆé€£çµ**: [https://github.com/Showyuan/decentralized-midterm-peer-evaluation](https://github.com/Showyuan/decentralized-midterm-peer-evaluation)

**ç·šä¸Šç³»çµ±**: [https://ntublockchainintro2025.online/](https://ntublockchainintro2025.online/)

---

**æ–‡ä»¶ç‰ˆæœ¬**: 2.0  
**æœ€å¾Œæ›´æ–°**: 2025-10-06  
**ç¶­è­·ç‹€æ…‹**: æŒçºŒç¶­è­·ä¸­ âœ…
